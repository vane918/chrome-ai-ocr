# Chrome OCR

基于 AI 的 Chrome 浏览器 OCR 插件，支持 Google Gemini 和通义千问（阿里云百炼）两大服务商。框选网页任意区域，自动识别并提取其中的文字。

## 功能特性

- **框选识别**：在网页上拖拽选取任意矩形区域
- **双服务商支持**：可选 Google Gemini 或通义千问（qwen-vl-ocr），按需切换
- **格式保留**：自动识别表格（输出为 Markdown 表格）、代码块、段落结构
- **多模型可选**：Gemini 和 Qwen 各提供多个模型版本
- **自定义提示词**：支持修改 OCR 提示词，适配不同识别场景
- **高 DPI 适配**：Retina 屏幕下截图精度无损

## 安装

### 方式一：加载源码（开发者模式）

适合自己使用或二次开发，无需打包，改代码后刷新即生效。

1. 打开 Chrome，访问 `chrome://extensions/`
2. 开启右上角的**开发者模式**
3. 点击**加载已解压的扩展程序**
4. 选择本项目所在目录

安装完成后，工具栏会出现插件图标（紫色 T 字）。

> 修改代码后，在 `chrome://extensions/` 页面点击插件卡片上的刷新按钮使改动生效。

---

### 方式二：打包为 .crx 离线安装包（分发给他人）

将插件打包成 `.crx` 文件后，可在不联网的情况下分发安装。

#### 第一步：打包插件

1. 打开 Chrome，访问 `chrome://extensions/`
2. 开启右上角的**开发者模式**
3. 点击**打包扩展程序**
4. 在**扩展程序根目录**中选择本项目所在目录（留空**私钥文件**，首次打包自动生成）
5. 点击**打包扩展程序**

打包完成后，会在项目目录的**上一级**生成两个文件：
- `chrome-ai-ocr.crx` — 安装包，分发给用户
- `chrome-ai-ocr.pem` — 私钥文件，**务必妥善保管**，下次更新插件时需要用到

> 再次打包时，需在**私钥文件**栏选择之前生成的 `.pem` 文件，否则会生成签名不同的新插件，已安装的用户无法收到更新。

#### 第二步：安装 .crx 文件

由于 Chrome 安全限制，`.crx` 文件**不能直接拖入安装**，需要通过以下步骤：

1. 打开 Chrome，访问 `chrome://extensions/`
2. 开启右上角的**开发者模式**
3. 将 `.crx` 文件**拖拽到** `chrome://extensions/` 页面上
4. 在弹出的确认对话框中点击**添加扩展程序**

> **注意**：Chrome 126 及更高版本对非商店插件限制更严，若拖拽后出现"只能通过 Chrome 网上应用店安装"提示，请改用**方式一（加载源码）**，或通过企业策略部署。

#### 更新已安装的离线插件

1. 用相同的 `.pem` 私钥重新打包，生成新的 `.crx`
2. 将新 `.crx` 拖拽到 `chrome://extensions/` 页面覆盖安装

## 配置

插件支持两个 AI 服务商，根据网络环境和偏好选择其一即可。

### Google Gemini（境外网络）

1. 访问 [Google AI Studio](https://aistudio.google.com/app/apikey) 获取免费 API Key
2. 点击浏览器工具栏中的插件图标，进入**设置**
3. 服务商选择 **Google Gemini**
4. 在 **Gemini API Key** 输入框中填入 Key（格式为 `AIza...`）
5. 点击**保存设置**

### 通义千问（国内网络可直连）

1. 访问 [阿里云百炼控制台](https://bailian.console.aliyun.com/) 获取 DashScope API Key
2. 点击浏览器工具栏中的插件图标，进入**设置**
3. 服务商选择**通义千问（阿里云百炼）**
4. 在 **DashScope API Key** 输入框中填入 Key（格式为 `sk-...`）
5. 点击**保存设置**

## 使用方法

1. 打开任意普通网页
2. 点击工具栏中的插件图标
3. 点击**开始截图识别**，弹窗自动关闭
4. 页面进入截图模式，鼠标变为十字准星
5. **按住鼠标左键拖拽**，选取包含文字的区域，松开后自动识别
6. 识别结果显示在页面右侧悬浮面板中
7. 点击面板右上角的 **×** 关闭结果，或按 `Esc` 取消选取

> 插件不支持在 `chrome://`、`chrome-extension://`、`edge://` 等浏览器内置页面上使用，请切换到普通网页。

## 设置选项

| 选项 | 说明 |
|------|------|
| AI 服务提供商 | 选择 Google Gemini 或通义千问 |
| API Key | 对应服务商的密钥 |
| 识别模型 | 当前服务商下可选的模型版本 |
| OCR 提示词 | 自定义发送给模型的识别指令 |

### 模型对比

**Google Gemini**

| 模型 | 速度 | 精度 | 推荐场景 |
|------|------|------|----------|
| gemini-2.5-flash | 最快 | 高 | 日常使用（默认推荐） |
| gemini-2.5-pro | 较慢 | 更高 | 复杂排版、手写体 |
| gemini-2.0-flash | 快 | 高 | 备选方案 |
| gemini-1.5-flash | 快 | 良好 | 低延迟场景 |
| gemini-1.5-pro | 较慢 | 良好 | 旧版模型兼容 |

**通义千问**

| 模型 | 说明 | 推荐场景 |
|------|------|----------|
| qwen-vl-ocr-latest | 最新版，持续更新 | 国内网络，日常使用（默认推荐） |
| qwen-vl-ocr | 稳定版 | 需要固定模型版本的场景 |

### 自定义提示词

默认提示词会完整提取文字、保留段落、识别表格和代码块。若有特殊需求可自行修改，例如：

- 只提取数字
- 翻译识别内容
- 以特定格式输出

点击**恢复默认提示词**可随时还原。

## 权限说明

| 权限 | 用途 |
|------|------|
| `activeTab` | 截取当前标签页的可见内容 |
| `storage` | 保存 API Key、模型、提示词配置 |
| `scripting` | 向页面注入选区 UI 和结果面板 |
| `https://generativelanguage.googleapis.com/*` | 访问 Gemini API |
| `https://dashscope.aliyuncs.com/*` | 访问通义千问 API |

## 注意事项

- API Key 仅存储在本地 Chrome 同步存储中，不会上传到第三方服务器
- 截图内容会以 base64 格式发送至所选 AI 服务的 API，请避免对含有敏感信息的内容使用
- 每次识别请求有 30 秒超时限制
- Gemini API 需要科学上网环境（中国大陆地区）；通义千问 API 国内可直连
